package entity

import (
	"github.com/google/uuid"
	"github.com/phanirithvij/fate/f8/xfs"
	"gorm.io/gorm"
)

// BaseEntity a base entity model
type BaseEntity struct {
	// ID entity id autogenerated
	gorm.Model
	UID     string
	Buckets []xfs.Bucket `gorm:"foreignKey:EntityID"`
	// Register func(db *gorm.DB) error `gorm:"-"`
}

// NewBase a new base
func NewBase() *BaseEntity {
	id := uuid.New()
	return &BaseEntity{
		UID:     id.String(),
		Buckets: []xfs.Bucket{{ID: "default"}},
	}
}

func (b *BaseEntity) String() string {
	return "Base@" + b.UID
}

// AutoMigrate auto migrations required for the database
func (b *BaseEntity) AutoMigrate(db *gorm.DB) error {
	xfs.AutoMigrate(db)
	return db.Debug().AutoMigrate(&xfs.Bucket{})
}
