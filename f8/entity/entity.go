package entity

import (
	"github.com/google/uuid"
	"github.com/phanirithvij/fate/f8/xfs"
	"gorm.io/gorm"
)

// BaseEntity a base entity model
type BaseEntity struct {
	// ID entity id autogenerated
	UID     string        `gorm:"primaryKey"`
	Buckets []*xfs.Bucket `gorm:"polymorphic:Entity"`
}

// NewBase a new base
func NewBase() *BaseEntity {
	id := uuid.New()
	return &BaseEntity{
		UID:     id.String(),
		Buckets: []*xfs.Bucket{xfs.NewBucket("")},
	}
}

// AutoMigrate auto migrations required for the database
//
// Note: BaseEntity will not auto migrate because it's the parent's responsibility
func AutoMigrate(db *gorm.DB) error {
	return xfs.AutoMigrate(db)
}
